<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>后台（admin_v30）账号管理最小可用版</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e6ebf2;
      --brand:#2563eb; --danger:#dc2626; --ok:#16a34a;
      --shadow: 0 8px 24px rgba(15,23,42,.08);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans SC", Arial;
    }
    body{ margin:0; background:var(--bg); color:var(--ink); }
    .wrap{ max-width:1100px; margin:24px auto; padding:0 16px; }
    .top{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .title{ font-size:18px; font-weight:700; }
    .badge{ font-size:12px; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; border:1px solid #e0e7ff; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow); }
    .row{ display:flex; gap:12px; flex-wrap:wrap; }
    .p16{ padding:16px; }
    .muted{ color:var(--muted); }
    .kpi{ display:flex; gap:16px; flex-wrap:wrap; }
    .kpi .item{ min-width:180px; }
    .kpi .num{ font-size:22px; font-weight:800; }
    .btn{ border:1px solid var(--line); background:#fff; color:var(--ink); padding:8px 12px; border-radius:10px; cursor:pointer; }
    .btn.primary{ background:var(--brand); border-color:var(--brand); color:#fff; }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    .input{ border:1px solid var(--line); border-radius:10px; padding:8px 10px; background:#fff; min-width:220px; }
    table{ width:100%; border-collapse:collapse; }
    th,td{ padding:10px 10px; border-bottom:1px solid var(--line); font-size:14px; vertical-align:middle; }
    th{ text-align:left; color:#334155; background:#fafafa; position:sticky; top:0; z-index:1; }
    a.link{ color:var(--brand); text-decoration:none; cursor:pointer; }
    a.link:hover{ text-decoration:underline; }
    .pill{ display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--line); background:#fff; }
    .pill.ok{ border-color:#bbf7d0; background:#f0fdf4; color:#166534; }
    .pill.bad{ border-color:#fecaca; background:#fef2f2; color:#991b1b; }

    /* modal */
    .backdrop{ position:fixed; inset:0; background:rgba(15,23,42,.45); display:none; align-items:center; justify-content:center; padding:16px; }
    .modal{ width:min(780px, 100%); background:#fff; border-radius:16px; border:1px solid var(--line); box-shadow:var(--shadow); overflow:hidden; }
    .mhead{ padding:14px 16px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--line); }
    .mbody{ padding:16px; }
    .mfoot{ padding:14px 16px; display:flex; gap:10px; justify-content:flex-end; border-top:1px solid var(--line); background:#fafafa; }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .field label{ display:block; font-size:12px; color:#475569; margin-bottom:6px; }
    .field input{ width:100%; }
    .note{ font-size:12px; color:var(--muted); margin-top:6px; }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr; } }
  
    /* readonly display */
    .robox{ border:1px solid var(--line); border-radius:10px; padding:10px 10px; background:#f8fafc; min-height:40px; display:flex; align-items:center; }
    .roval{ white-space:pre-wrap; word-break:break-word; }
    .roempty{ color:var(--muted); }

  
    .filters{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:center; }
    .batchbar{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:center; }
    .chk{ display:inline-flex; align-items:center; gap:8px; color:var(--muted); font-size:14px; }
    .btnGhost{ background:#fff; border:1px dashed var(--line); color:var(--muted); }
    .btnGhost:hover{ border-style:solid; }
    table td.sel{ width:40px; }

  
    .parsebox{ margin-top:12px; padding:12px; border:1px solid var(--line); border-radius:14px; background:#fbfcff; }
    .parseactions{ display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="title">admin_v31.3 账号库（扩展字段/报名/批量标记/解析勾选） <span class="badge">账号：可点 → 可编辑 → 可保存 → 刷新仍在</span></div>
      <div class="muted">IndexedDB 读取：<b>act_acc_v199</b> / store: <b>accounts</b></div>
    </div>

    <div class="row" style="margin-top:14px;">
      <div class="card p16" style="flex:1 1 360px;">
        <div class="kpi">
          <div class="item">
            <div class="muted">账号数量</div>
            <div class="num" id="kpiAccounts">—</div>
          </div>
          <div class="item">
            <div class="muted">活动数量</div>
            <div class="num" id="kpiActivities">—</div>
          </div>
          <div class="item">
            <div class="muted">状态</div>
            <div id="kpiStatus" class="pill">初始化中…</div>
          </div>
        </div>
        <div class="note">本页只做“账号库最小闭环”。同步（Push/Pull/Deletes）暂不启用，避免干扰验收。<br/><b>提示：</b>IndexedDB 数据按“域名”隔离；你在 Vercel 域名录入的数据，不会自动出现在 GitHub Pages 域名。可用【导入JSON】把旧域名导出的账号导入到当前域名进行验证。</div>
      </div>

      <div class="card p16" style="flex:1 1 360px;">
        <div class="row" style="align-items:center;">
          <input id="q" class="input" placeholder="搜索账号 / 标签 / 状态…" />
          <button id="btnReload" class="btn">重新加载</button>
          <button id="btnImportJson" class="btn">导入JSON（账号）</button>
          <button id="btnAddTest" class="btn">新增测试账号</button>
          <button id="btnExportJson" class="btn">导出JSON（筛选后）</button>
          <input id="fileJson" type="file" accept="application/json" style="display:none" />
        
        <div class="filters">
          <input id="fActivity" class="input" style="max-width:240px" placeholder="活动报名（筛选/批量设置）"/>
          <select id="fWin" class="input" style="max-width:140px">
            <option value="">中签：全部</option>
            <option value="yes">中签</option>
            <option value="no">未中签</option>
          </select>
          <select id="fPaid" class="input" style="max-width:140px">
            <option value="">付款：全部</option>
            <option value="yes">已付款</option>
            <option value="no">未付款</option>
          </select>
          <input id="fTag" class="input" style="max-width:200px" placeholder="标签包含…"/>
          <button id="btnApplyFilters" class="btn">应用筛选</button>
          <button id="btnClearFilters" class="btn btnGhost">清空筛选</button>
        </div>

        
        <div class="parsebox">
          <textarea id="parseInput" class="input" rows="3" style="width:100%;max-width:760px" placeholder="粘贴账号/邮箱（每行一个，或用空格/逗号分隔）。示例：
001@dalemy.top
002@dalemy.top"></textarea>
          <div class="parseactions">
            <button id="btnParseSelect" class="btn">解析并勾选</button>
            <button id="btnParseClear" class="btn btnGhost">清空输入</button>
          </div>
          <div class="note" style="margin-top:6px">解析规则：自动提取邮箱样式文本；匹配到账号库中的 account 即勾选。可配合批量报名/中签/已付款使用。</div>
        </div>

<div class="batchbar">
          <label class="chk"><input id="chkAll" type="checkbox"/> 全选（当前筛选结果）</label>
          <button id="btnBatchApply" class="btn">批量报名</button>
          <button id="btnBatchWin" class="btn">批量标记中签</button>
          <button id="btnBatchPaid" class="btn">批量标记已付款</button>
          <button id="btnBatchClear" class="btn btnGhost">批量清除标记</button>
          <button id="btnExportCsv" class="btn">导出CSV（筛选后）</button>
        </div>
</div>
        <div class="note">导出用于“先验证本地可写入”，后续再接同步与云端。</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px;">
      <div class="p16" style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
        <div><b>账号列表</b> <span class="muted" id="listInfo"></span></div>
        <div class="muted" id="dbInfo"></div>
      </div>
      <div style="max-height:65vh; overflow:auto;">
        <table>
          <thead>
          <tr>
            <th></th>
            <th>账户</th>
            <th>标签</th>
            <th>活动报名</th>
            <th>中签</th>
            <th>已付款</th>
            <th>状态</th>
            <th>更新时间</th>
          </tr>
        </thead>
          <tbody id="tbody">
            <tr><td colspan="4" class="muted">加载中…</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="backdrop" id="backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mhead">
        <div>
          <div style="font-weight:800;">账号详情</div>
          <div class="muted" id="mSub">—</div>
        </div>
        <button class="btn" id="btnClose">关闭</button>
      </div>
      <div class="mbody">
        <div class="grid" id="form">
          <!-- filled by js -->
        </div>
        <div class="note" id="saveHint"></div>
      </div>
      <div class="mfoot">
        <button class="btn" id="btnEdit">编辑</button>
        <button class="btn primary" id="btnSave" disabled>保存</button>
        <button class="btn" id="btnCancel" disabled>取消</button>
      </div>
    </div>
  </div>

  <script type="module" src="./main.js"></script>
</body>
</html>
